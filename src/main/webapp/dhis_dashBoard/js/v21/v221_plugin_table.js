Ext.onReady(function(){Ext.Ajax.method="GET";Ext.isIE=(/trident/.test(Ext.userAgent));Ext.isIE11=Ext.isIE&&(/rv:11.0/.test(Ext.userAgent));Ext.util.CSS.createStyleSheet=function(k,n){var j,i=document.getElementsByTagName("head")[0],m=document.createElement("style");m.setAttribute("type","text/css");if(n){m.setAttribute("id",n)}if(Ext.isIE&&!Ext.isIE11){i.appendChild(m);j=m.styleSheet;j.cssText=k}else{try{m.appendChild(document.createTextNode(k))}catch(l){m.cssText=k}i.appendChild(m);j=m.styleSheet?m.styleSheet:(m.sheet||document.styleSheets[document.styleSheets.length-1])}this.cacheStyleSheet(j);return j};g={};var g=g;g.instances=[];g.i18n={};g.isDebug=false;g.isSessionStorage=("sessionStorage" in window&&window.sessionStorage!==null);g.getCore=function(q,r){var m={},k={},p={},l={},j={},i={},o,n;r=r||{};o=function(){};i.getViewportWidth=function(){};i.getViewportHeight=function(){};i.getCenterRegionWidth=function(){};i.getCenterRegionHeight=function(){};(function(){m.finals={dimension:{data:{value:"data",name:g.i18n.data||"Data",dimensionName:"dx",objectName:"dx"},category:{name:g.i18n.assigned_categories||"Assigned categories",dimensionName:"co",objectName:"co"},indicator:{value:"indicators",name:g.i18n.indicators||"Indicators",dimensionName:"dx",objectName:"in"},dataElement:{value:"dataElements",name:g.i18n.data_elements||"Data elements",dimensionName:"dx",objectName:"de"},operand:{value:"operand",name:"Operand",dimensionName:"dx",objectName:"dc"},dataSet:{value:"dataSets",name:g.i18n.data_sets||"Data sets",dimensionName:"dx",objectName:"ds"},eventDataItem:{value:"eventDataItem",name:g.i18n.event_data_items||"Event data items",dimensionName:"dx",objectName:"di"},programIndicator:{value:"programIndicator",name:g.i18n.program_indicators||"Program indicators",dimensionName:"dx",objectName:"pi"},period:{value:"period",name:g.i18n.periods||"Periods",dimensionName:"pe",objectName:"pe"},fixedPeriod:{value:"periods"},relativePeriod:{value:"relativePeriods"},organisationUnit:{value:"organisationUnits",name:g.i18n.organisation_units||"Organisation units",dimensionName:"ou",objectName:"ou"},dimension:{value:"dimension"},value:{value:"value"}},root:{id:"root"},style:{normal:"NORMAL",compact:"COMPACT",xcompact:"XCOMPACT",comfortable:"COMFORTABLE",xcomfortable:"XCOMFORTABLE",small:"SMALL",xsmall:"XSMALL",large:"LARGE",xlarge:"XLARGE",space:"SPACE",comma:"COMMA",none:"NONE",default_:"DEFAULT"}};(function(){n=m.finals.dimension;n.objectNameMap={};n.objectNameMap[n.data.objectName]=n.data;n.objectNameMap[n.indicator.objectName]=n.indicator;n.objectNameMap[n.dataElement.objectName]=n.dataElement;n.objectNameMap[n.operand.objectName]=n.operand;n.objectNameMap[n.dataSet.objectName]=n.dataSet;n.objectNameMap[n.category.objectName]=n.category;n.objectNameMap[n.period.objectName]=n.period;n.objectNameMap[n.organisationUnit.objectName]=n.organisationUnit;n.objectNameMap[n.dimension.objectName]=n.dimension})();m.period={periodTypes:[{id:"Daily",name:g.i18n.daily},{id:"Weekly",name:g.i18n.weekly},{id:"Monthly",name:g.i18n.monthly},{id:"BiMonthly",name:g.i18n.bimonthly},{id:"Quarterly",name:g.i18n.quarterly},{id:"SixMonthly",name:g.i18n.sixmonthly},{id:"SixMonthlyApril",name:g.i18n.sixmonthly_april},{id:"Yearly",name:g.i18n.yearly},{id:"FinancialOct",name:g.i18n.financial_oct},{id:"FinancialJuly",name:g.i18n.financial_july},{id:"FinancialApril",name:g.i18n.financial_april}],relativePeriods:[]};m.valueType={numericTypes:["NUMBER","UNIT_INTERVAL","PERCENTAGE","INTEGER","INTEGER_POSITIVE","INTEGER_NEGATIVE","INTEGER_ZERO_OR_POSITIVE"],textTypes:["TEXT","LONG_TEXT","LETTER","PHONE_NUMBER","EMAIL"],booleanTypes:["BOOLEAN","TRUE_ONLY"],dateTypes:["DATE","DATETIME"],aggregateTypes:["NUMBER","UNIT_INTERVAL","PERCENTAGE","INTEGER","INTEGER_POSITIVE","INTEGER_NEGATIVE","INTEGER_ZERO_OR_POSITIVE","BOOLEAN","TRUE_ONLY"]};m.layout={west_width:424,west_fieldset_width:418,west_width_padding:2,west_fill:2,west_fill_accordion_indicator:81,west_fill_accordion_dataelement:81,west_fill_accordion_dataset:56,west_fill_accordion_eventdataitem:81,west_fill_accordion_programindicator:81,west_fill_accordion_period:310,west_fill_accordion_organisationunit:58,west_fill_accordion_group:31,west_maxheight_accordion_indicator:400,west_maxheight_accordion_dataelement:400,west_maxheight_accordion_dataset:400,west_maxheight_accordion_period:513,west_maxheight_accordion_organisationunit:900,west_maxheight_accordion_group:340,west_maxheight_accordion_options:449,west_scrollbarheight_accordion_indicator:300,west_scrollbarheight_accordion_dataelement:300,west_scrollbarheight_accordion_dataset:300,west_scrollbarheight_accordion_period:450,west_scrollbarheight_accordion_organisationunit:450,west_scrollbarheight_accordion_group:300,east_tbar_height:31,east_gridcolumn_height:30,form_label_width:55,window_favorite_ypos:100,window_confirm_width:250,window_share_width:500,grid_favorite_width:420,grid_row_height:27,treepanel_minheight:135,treepanel_maxheight:400,treepanel_fill_default:310,treepanel_toolbar_menu_width_group:140,treepanel_toolbar_menu_width_level:120,multiselect_minheight:100,multiselect_maxheight:250,multiselect_fill_default:345,multiselect_fill_reportingrates:315};m.style={displayDensity:{},fontSize:{},digitGroupSeparator:{}};(function(){var v=m.finals.style,u=m.style.displayDensity,t=m.style.fontSize,s=m.style.digitGroupSeparator;u[v.xcompact]="2px";u[v.compact]="4px";u[v.normal]="6px";u[v.comfortable]="8px";u[v.xcomfortable]="10px";t[v.xsmall]="9px";t[v.small]="10px";t[v.normal]="11px";t[v.large]="12px";t[v.xlarge]="14px";s[v.space]="&nbsp;";s[v.comma]=",";s[v.none]=""})();m.url={analysisFields:["*","program[id,name]","programStage[id,name]","columns[dimension,filter,items[id,"+q.namePropertyUrl+"]]","rows[dimension,filter,items[id,"+q.namePropertyUrl+"]]","filters[dimension,filter,items[id,"+q.namePropertyUrl+"]]","!lastUpdated","!href","!created","!publicAccess","!rewindRelativePeriods","!userOrganisationUnit","!userOrganisationUnitChildren","!userOrganisationUnitGrandChildren","!externalAccess","!access","!relativePeriods","!columnDimensions","!rowDimensions","!filterDimensions","!user","!organisationUnitGroups","!itemOrganisationUnitGroups","!userGroupAccesses","!indicators","!dataElements","!dataElementOperands","!dataElementGroups","!dataSets","!periods","!organisationUnitLevels","!organisationUnits"]}}());(function(){k.layout={};k.layout.Record=function(s){var s=Ext.clone(s);return function(){if(!Ext.isObject(s)){console.log("Record: config is not an object: "+s);return}if(!Ext.isString(s.id)){console.log("api.layout.Record: id is not text: "+s);return}return s}()};k.layout.Dimension=function(s){var s=Ext.clone(s);return function(){if(!Ext.isObject(s)){console.log("Dimension: config is not an object: "+s);return}if(!Ext.isString(s.dimension)){console.log("Dimension: name is not a string: "+s);return}if(s.dimension!==m.finals.dimension.category.objectName){var t=[];if(!Ext.isArray(s.items)){return}for(var u=0;u<s.items.length;u++){t.push(k.layout.Record(s.items[u]))}s.items=Ext.Array.clean(t);if(!s.items.length){return}}return s}()};k.layout.Layout=function(v,u,t){v=Ext.apply(v,u);var w={},s,x;s=function(z){var z=Ext.clone(z);if(!(z&&Ext.isArray(z)&&z.length)){return}for(var y=0;y<z.length;y++){z[y]=k.layout.Dimension(z[y])}z=Ext.Array.clean(z);return z.length?z:null};x=function(){var A=m.finals.dimension,z,B={};if(!w){return}z=Ext.Array.clean([].concat(w.columns||[],w.rows||[],w.filters||[]));for(var y=0;y<z.length;y++){B[z[y].dimension]=z[y]}if(w.filters&&w.filters.length){for(var y=0;y<w.filters.length;y++){if(w.filters[y].dimension===A.indicator.objectName){o(g.i18n.indicators_cannot_be_specified_as_filter||"Indicators cannot be specified as filter");return}if(w.filters[y].dimension===A.category.objectName){o(g.i18n.categories_cannot_be_specified_as_filter||"Categories cannot be specified as filter");return}if(w.filters[y].dimension===A.dataSet.objectName){o(g.i18n.data_sets_cannot_be_specified_as_filter||"Data sets cannot be specified as filter");return}}}if(B[A.operand.objectName]&&B[A.indicator.objectName]){o("Indicators and detailed data elements cannot be specified together");return}if(B[A.operand.objectName]&&B[A.dataElement.objectName]){o("Detailed data elements and totals cannot be specified together");return}if(B[A.operand.objectName]&&B[A.dataSet.objectName]){o("Data sets and detailed data elements cannot be specified together");return}if(B[A.operand.objectName]&&B[A.category.objectName]){o("Assigned categories and detailed data elements cannot be specified together");return}if(B[A.indicator.objectName]&&v.aggregationType!==m.finals.style.default_){o("Indicators and aggregation types cannot be specified together",true);return}return true};return function(){var y=[],A=m.finals.dimension;if(!(v&&Ext.isObject(v))){console.log("Layout: config is not an object ("+q.el+")");return}if(!(v.columns||v.rows)){o(g.i18n.at_least_one_dimension_must_be_specified_as_row_or_column);return}for(var z=0,B=Ext.Array.clean([].concat(v.columns||[],v.rows||[],v.filters||[]));z<B.length;z++){if(k.layout.Dimension(B[z])){y.push(B[z].dimension)}}if(!Ext.Array.contains(y,A.period.objectName)){o(g.i18n.at_least_one_period_must_be_specified_as_column_row_or_filter);return}if(v.id){w.id=v.id}if(v.name){w.name=v.name}w.columns=v.columns;w.rows=v.rows;w.filters=v.filters;w.showColTotals=Ext.isBoolean(v.colTotals)?v.colTotals:(Ext.isBoolean(v.showColTotals)?v.showColTotals:true);w.showRowTotals=Ext.isBoolean(v.rowTotals)?v.rowTotals:(Ext.isBoolean(v.showRowTotals)?v.showRowTotals:true);w.showColSubTotals=Ext.isBoolean(v.colSubTotals)?v.colSubTotals:(Ext.isBoolean(v.showColSubTotals)?v.showColSubTotals:true);w.showRowSubTotals=Ext.isBoolean(v.rowSubTotals)?v.rowSubTotals:(Ext.isBoolean(v.showRowSubTotals)?v.showRowSubTotals:true);w.showDimensionLabels=Ext.isBoolean(v.showDimensionLabels)?v.showDimensionLabels:(Ext.isBoolean(v.showDimensionLabels)?v.showDimensionLabels:true);w.hideEmptyRows=Ext.isBoolean(v.hideEmptyRows)?v.hideEmptyRows:false;w.skipRounding=Ext.isBoolean(v.skipRounding)?v.skipRounding:false;w.aggregationType=Ext.isString(v.aggregationType)?v.aggregationType:m.finals.style.default_;w.dataApprovalLevel=Ext.isObject(v.dataApprovalLevel)&&Ext.isString(v.dataApprovalLevel.id)?v.dataApprovalLevel:null;w.showHierarchy=Ext.isBoolean(v.showHierarchy)?v.showHierarchy:false;w.completedOnly=Ext.isBoolean(v.completedOnly)?v.completedOnly:false;w.displayDensity=Ext.isString(v.displayDensity)&&!Ext.isEmpty(v.displayDensity)?v.displayDensity:m.finals.style.normal;w.fontSize=Ext.isString(v.fontSize)&&!Ext.isEmpty(v.fontSize)?v.fontSize:m.finals.style.normal;w.digitGroupSeparator=Ext.isString(v.digitGroupSeparator)&&!Ext.isEmpty(v.digitGroupSeparator)?v.digitGroupSeparator:m.finals.style.space;w.legendSet=Ext.isObject(v.legendSet)&&Ext.isString(v.legendSet.id)?v.legendSet:null;w.parentGraphMap=Ext.isObject(v.parentGraphMap)?v.parentGraphMap:null;w.sorting=Ext.isObject(v.sorting)&&Ext.isDefined(v.sorting.id)&&Ext.isString(v.sorting.direction)?v.sorting:null;w.reportingPeriod=Ext.isObject(v.reportParams)&&Ext.isBoolean(v.reportParams.paramReportingPeriod)?v.reportParams.paramReportingPeriod:(Ext.isBoolean(v.reportingPeriod)?v.reportingPeriod:false);w.organisationUnit=Ext.isObject(v.reportParams)&&Ext.isBoolean(v.reportParams.paramOrganisationUnit)?v.reportParams.paramOrganisationUnit:(Ext.isBoolean(v.organisationUnit)?v.organisationUnit:false);w.parentOrganisationUnit=Ext.isObject(v.reportParams)&&Ext.isBoolean(v.reportParams.paramParentOrganisationUnit)?v.reportParams.paramParentOrganisationUnit:(Ext.isBoolean(v.parentOrganisationUnit)?v.parentOrganisationUnit:false);w.regression=Ext.isBoolean(v.regression)?v.regression:false;w.cumulative=Ext.isBoolean(v.cumulative)?v.cumulative:false;w.sortOrder=Ext.isNumber(v.sortOrder)?v.sortOrder:0;w.topLimit=Ext.isNumber(v.topLimit)?v.topLimit:0;if(Ext.isString(v.displayProperty)){w.displayProperty=v.displayProperty}if(Ext.Array.from(v.userOrgUnit).length){w.userOrgUnit=Ext.Array.from(v.userOrgUnit)}if(Ext.isObject(v.program)){w.program=v.program}if(p.prototype.date.getYYYYMMDD(v.relativePeriodDate)){w.relativePeriodDate=p.prototype.date.getYYYYMMDD(v.relativePeriodDate)}if(!x()){return}return Ext.apply(w,t)}()};k.response={};k.response.Header=function(s){var s=Ext.clone(s);return function(){if(!Ext.isObject(s)){console.log("Header: config is not an object: "+s);return}if(!Ext.isString(s.name)){console.log("Header: name is not a string: "+s);return}if(!Ext.isBoolean(s.meta)){console.log("Header: meta is not boolean: "+s);return}return s}()};k.response.Response=function(s){var s=Ext.clone(s);return function(){if(!(s&&Ext.isObject(s))){console.log("Response: config is not an object");return}if(!(s.headers&&Ext.isArray(s.headers))){console.log("Response: headers is not an array");return}for(var t=0,u;t<s.headers.length;t++){s.headers[t]=k.response.Header(s.headers[t])}s.headers=Ext.Array.clean(s.headers);if(!s.headers.length){console.log("Response: no valid headers");return}if(!(Ext.isArray(s.rows)&&s.rows.length>0)){}if(s.rows.length>0&&s.headers.length!==s.rows[0].length){console.log("Response: headers.length !== rows[0].length")}return s}()}}());(function(){p.prototype={};p.prototype.array={};p.prototype.array.getLength=function(t,s){if(!Ext.isArray(t)){if(!s){console.log("support.prototype.array.getLength: not an array")}return null}return t.length};p.prototype.array.sort=function(v,u,t,s){if(!p.prototype.array.getLength(v)){return}t=!!t||Ext.isNumber(t)?t:"name";v.sort(function(x,w){if(Ext.isObject(x)&&Ext.isObject(w)){x=x[t];w=w[t]}if(Ext.isArray(x)&&Ext.isArray(w)){x=x[t];w=w[t]}if(Ext.isString(x)&&Ext.isString(w)){x=x.toLowerCase();w=w.toLowerCase();if(u==="DESC"){return x<w?1:(x>w?-1:0)}else{return x<w?-1:(x>w?1:0)}}else{if(Ext.isNumber(x)&&Ext.isNumber(w)){return u==="DESC"?w-x:x-w}else{if(x===undefined||x===null){return s?-1:1}else{if(w===undefined||w===null){return s?1:-1}}}}return -1});return v};p.prototype.object={};p.prototype.object.getLength=function(s,v){if(!Ext.isObject(s)){if(!v){console.log("support.prototype.object.getLength: not an object")}return null}var u=0;for(var t in s){if(s.hasOwnProperty(t)){u++}}return u};p.prototype.object.hasObject=function(t,w,v){if(!p.prototype.object.getLength(t)){return null}for(var u in t){var s=t[u];if(t.hasOwnProperty(u)&&s[w]===v){return true}}return null};p.prototype.str={};p.prototype.str.replaceAll=function(u,t,s){return u.replace(new RegExp(t,"g"),s)};p.prototype.str.toggleDirection=function(s){return s==="DESC"?"ASC":"DESC"};p.prototype.number={};p.prototype.number.getNumberOfDecimals=function(s){var t=new String(s);return(t.indexOf(".")>-1)?(t.length-t.indexOf(".")-1):0};p.prototype.number.roundIf=function(u,s){u=parseFloat(u);s=parseFloat(s);if(Ext.isNumber(u)&&Ext.isNumber(s)){var t=p.prototype.number.getNumberOfDecimals(u);return t>s?Ext.Number.toFixed(u,s):u}return u};p.prototype.number.prettyPrint=function(s,t){t=m.style.digitGroupSeparator[t]?t:m.finals.style.space;if(t===m.finals.style.none){return s}return s.toString().replace(/\B(?=(\d{3})+(?!\d))/g,m.style.digitGroupSeparator[t])};p.prototype.date={};p.prototype.date.getYYYYMMDD=function(v){if(!Ext.isString(v)){if(!(Object.prototype.toString.call(v)==="[object Date]"&&v.toString()!=="Invalid date")){return null}}var t=new Date(v),u=""+(1+t.getMonth()),s=""+t.getDate();u=u.length===1?"0"+u:u;s=s.length===1?"0"+s:s;return t.getFullYear()+"-"+u+"-"+s};p.color={};p.color.hexToRgb=function(u){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,s;u=u.replace(t,function(w,y,x,v){return y+y+x+x+v+v});s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(u);return s?{r:parseInt(s[1],16),g:parseInt(s[2],16),b:parseInt(s[3],16)}:null};p.connection={};p.connection.ajax=function(s,t){if(t.crossDomain&&Ext.isString(t.username)&&Ext.isString(t.password)){s.headers=Ext.isObject(t.headers)?t.headers:{};s.headers.Authorization="Basic "+btoa(t.username+":"+t.password)}Ext.Ajax.request(s)}}());(function(){l.layout={};l.layout.cleanDimensionArray=function(t){if(!p.prototype.array.getLength(t)){return null}var u=[];for(var s=0;s<t.length;s++){u.push(k.layout.Dimension(t[s]))}u=Ext.Array.clean(u);return u.length?u:null};l.layout.sortDimensionArray=function(v,u){if(!p.prototype.array.getLength(v,true)){return null}v=l.layout.cleanDimensionArray(v);if(!v){console.log("service.layout.sortDimensionArray: no valid dimensions");return null}u=u||"dimensionName";Ext.Array.sort(v,function(x,w){if(x[u]<w[u]){return -1}if(x[u]>w[u]){return 1}return 0});for(var t=0,s;t<v.length;t++){p.prototype.array.sort(v[t].items,"ASC","id");if(p.prototype.array.getLength(v[t].ids)){p.prototype.array.sort(v[t].ids)}}return v};l.layout.getObjectNameDimensionMapFromDimensionArray=function(v){var u={};if(!p.prototype.array.getLength(v)){return null}for(var s=0,t;s<v.length;s++){t=k.layout.Dimension(v[s]);if(t){u[t.dimension]=t}}return p.prototype.object.getLength(u)?u:null};l.layout.getObjectNameDimensionItemsMapFromDimensionArray=function(v){var u={};if(!p.prototype.array.getLength(v)){return null}for(var s=0,t;s<v.length;s++){t=k.layout.Dimension(v[s]);if(t){u[t.dimension]=t.items}}return p.prototype.object.getLength(u)?u:null};l.layout.getItemName=function(y,u,z,x){var t=u.metaData,v="";if(l.layout.isHierarchy(y,u,z)){var s=Ext.Array.clean(t.ouHierarchy[z].split("/"));s.shift();for(var w=0;w<s.length;w++){v+=(x?'<span class="text-weak">':"")+t.names[s[w]]+(x?"</span>":"")+" / "}}v+=t.names[z];return v};l.layout.getExtendedLayout=function(x){var x=Ext.clone(x),z;z={columns:[],rows:[],filters:[],columnObjectNames:[],columnDimensionNames:[],rowObjectNames:[],rowDimensionNames:[],axisDimensions:[],axisObjectNames:[],axisDimensionNames:[],sortedAxisDimensionNames:[],filterDimensions:[],filterObjectNames:[],filterDimensionNames:[],sortedFilterDimensions:[],dimensions:[],objectNames:[],dimensionNames:[],objectNameDimensionsMap:{},objectNameItemsMap:{},objectNameIdsMap:{},dimensionNameDimensionsMap:{},dimensionNameItemsMap:{},dimensionNameIdsMap:{},dimensionNameSortedIdsMap:{},dimensionNameAxisMap:{}};Ext.applyIf(z,x);if(x.columns){for(var v=0,w,y,s;v<x.columns.length;v++){w=x.columns[v];y=w.items;s={};s.dimension=w.dimension;s.objectName=w.dimension;s.dimensionName=n.objectNameMap[w.dimension].dimensionName;if(y){s.items=y;s.ids=[];for(var u=0;u<y.length;u++){s.ids.push(y[u].id)}}z.columns.push(s);z.columnObjectNames.push(s.objectName);z.columnDimensionNames.push(s.dimensionName);z.axisDimensions.push(s);z.axisObjectNames.push(s.objectName);z.axisDimensionNames.push(n.objectNameMap[s.objectName].dimensionName);z.objectNameDimensionsMap[s.objectName]=s;z.objectNameItemsMap[s.objectName]=s.items;z.objectNameIdsMap[s.objectName]=s.ids;z.dimensionNameAxisMap[s.dimensionName]=z.columns}}if(x.rows){for(var v=0,w,y,s;v<x.rows.length;v++){w=Ext.clone(x.rows[v]);y=w.items;s={};s.dimension=w.dimension;s.objectName=w.dimension;s.dimensionName=n.objectNameMap[w.dimension].dimensionName;if(y){s.items=y;s.ids=[];for(var u=0;u<y.length;u++){s.ids.push(y[u].id)}}z.rows.push(s);z.rowObjectNames.push(s.objectName);z.rowDimensionNames.push(s.dimensionName);z.axisDimensions.push(s);z.axisObjectNames.push(s.objectName);z.axisDimensionNames.push(n.objectNameMap[s.objectName].dimensionName);z.objectNameDimensionsMap[s.objectName]=s;z.objectNameItemsMap[s.objectName]=s.items;z.objectNameIdsMap[s.objectName]=s.ids;z.dimensionNameAxisMap[s.dimensionName]=z.rows}}if(x.filters){for(var v=0,w,y,s;v<x.filters.length;v++){w=x.filters[v];y=w.items;s={};s.dimension=w.dimension;s.objectName=w.dimension;s.dimensionName=n.objectNameMap[w.dimension].dimensionName;if(y){s.items=y;s.ids=[];for(var u=0;u<y.length;u++){s.ids.push(y[u].id)}}z.filters.push(s);z.filterDimensions.push(s);z.filterObjectNames.push(s.objectName);z.filterDimensionNames.push(n.objectNameMap[s.objectName].dimensionName);z.objectNameDimensionsMap[s.objectName]=s;z.objectNameItemsMap[s.objectName]=s.items;z.objectNameIdsMap[s.objectName]=s.ids;z.dimensionNameAxisMap[s.dimensionName]=z.filters}}z.legendSet=x.legendSet?q.idLegendSetMap[x.legendSet.id]:null;if(x.legendSet){z.legendSet=q.idLegendSetMap[x.legendSet.id];p.prototype.array.sort(z.legendSet.legends,"ASC","startValue")}z.axisDimensionNames=Ext.Array.unique(z.axisDimensionNames);z.filterDimensionNames=Ext.Array.unique(z.filterDimensionNames);z.columnDimensionNames=Ext.Array.unique(z.columnDimensionNames);z.rowDimensionNames=Ext.Array.unique(z.rowDimensionNames);z.filterDimensionNames=Ext.Array.unique(z.filterDimensionNames);z.sortedAxisDimensionNames=Ext.clone(z.axisDimensionNames).sort();z.sortedFilterDimensions=l.layout.sortDimensionArray(Ext.clone(z.filterDimensions));z.dimensions=[].concat(z.axisDimensions,z.filterDimensions);z.objectNames=[].concat(z.axisObjectNames,z.filterObjectNames);z.dimensionNames=[].concat(z.axisDimensionNames,z.filterDimensionNames);for(var v=0,t;v<z.dimensionNames.length;v++){t=z.dimensionNames[v];z.dimensionNameDimensionsMap[t]=[];z.dimensionNameItemsMap[t]=[];z.dimensionNameIdsMap[t]=[]}for(var v=0,s;v<z.dimensions.length;v++){s=z.dimensions[v];z.dimensionNameDimensionsMap[s.dimensionName].push(s);z.dimensionNameItemsMap[s.dimensionName]=z.dimensionNameItemsMap[s.dimensionName].concat(s.items);z.dimensionNameIdsMap[s.dimensionName]=z.dimensionNameIdsMap[s.dimensionName].concat(s.ids)}for(var A in z.dimensionNameIdsMap){if(z.dimensionNameIdsMap.hasOwnProperty(A)){z.dimensionNameSortedIdsMap[A]=Ext.clone(z.dimensionNameIdsMap[A]).sort()}}z.tableUuid=q.el+"_"+Ext.data.IdGenerator.get("uuid").generate();return z};l.layout.getSyncronizedXLayout=function(B,s){var E,w=Ext.Array.clean([].concat(B.columns||[],B.rows||[],B.filters||[])),M=B.objectNameDimensionsMap[n.organisationUnit.objectName],y=M&&Ext.Array.contains(M.ids,"USER_ORGUNIT"),O=M&&Ext.Array.contains(M.ids,"USER_ORGUNIT_CHILDREN"),L=M&&Ext.Array.contains(M.ids,"USER_ORGUNIT_GRANDCHILDREN"),t=function(){if(M&&Ext.isArray(M.ids)){for(var Q=0;Q<M.ids.length;Q++){if(M.ids[Q].substr(0,5)==="LEVEL"){return true}}}return false}(),A=function(){if(M&&Ext.isArray(M.ids)){for(var Q=0;Q<M.ids.length;Q++){if(M.ids[Q].substr(0,8)==="OU_GROUP"){return true}}}return false}(),x=n.category.objectName,v=n.organisationUnit.objectName,u=function(){var R=[];for(var Q=0;Q<s.headers.length;Q++){R.push(s.headers[Q].name)}return R}(),P;E=function(R){var Q;Q=function(T){var U;T=Ext.clone(T);for(var S=0;S<T.length;S++){if(T[S].dimension===R){U=T[S]}}if(U){Ext.Array.remove(T,U)}return T};if(B.columns){B.columns=Q(B.columns)}if(B.rows){B.rows=Q(B.rows)}if(B.filters){B.filters=Q(B.filters)}};for(var I=0,G,z,C;I<w.length;I++){G=w[I];G.items=[];z=s.metaData[G.objectName];if(Ext.isArray(z)&&z.length){var D=Ext.clone(s.metaData[G.dimensionName]);for(var F=0;F<D.length;F++){G.items.push({id:D[F],name:s.metaData.names[D[F]]})}}else{G.items=Ext.clone(B.objectNameItemsMap[G.objectName])}}w=Ext.Array.clean([].concat(B.columns||[],B.rows||[],B.filters||[]));for(var I=0,H=s.metaData.names,K;I<w.length;I++){K=w[I].items;if(Ext.isArray(K)&&K.length){for(var F=0,N;F<K.length;F++){N=K[F];if(Ext.isObject(N)&&Ext.isString(H[N.id])&&!Ext.isString(N.name)){N.name=H[N.id]||""}}}}for(var I=0,J;I<B.axisDimensionNames.length;I++){J=B.axisDimensionNames[I];if(!Ext.Array.contains(u,J)){E(J)}}P=k.layout.Layout(B);if(P){return l.layout.getExtendedLayout(P)}return null};l.layout.getExtendedAxis=function(F,ah){var x,v,H=[],D=1,R,u,L=[],ag=[],w=[],K=[],B=[],C=[],U=[],y={};if(ah==="col"){x=Ext.clone(F.columnDimensionNames);v="colSpan"}else{if(ah==="row"){x=Ext.clone(F.rowDimensionNames);v="rowSpan"}}if(!(Ext.isArray(x)&&x.length)){return}for(var ab=0;ab<x.length;ab++){H.push({dimensionName:x[ab]})}u=function(){var ai=[];for(var aj=0;aj<H.length;aj++){ai.push(F.dimensionNameIdsMap[H[aj].dimensionName])}return ai}();R=u.length;for(var ab=0,S;ab<R;ab++){S=u[ab].length;L.push(S);D=D*S;ag.push(D)}for(var ab=0;ab<R;ab++){if(L[ab]===1){if(ab===0){w.push(D)}else{if(F.hideEmptyRows&&ah==="row"){w.push(D/ag[ab])}else{w.push(w[0])}}}else{w.push(D/ag[ab])}}K.push(u[0]);if(R.length>1){for(var ab=1,ae,V;ab<R;ab++){ae=[];V=L[ab]===1?L[0]:ag[ab-1];for(var Z=0;Z<V;Z++){ae=ae.concat(u[ab])}K.push(ae)}}for(var ab=0,A,W,I,aa;ab<R;ab++){A=[];W=u[ab];I=w[ab];aa=D/(I*W.length);for(var Z=0;Z<aa;Z++){for(var Y=0;Y<W.length;Y++){for(var X=0;X<I;X++){A.push(W[Y])}}}B.push(A)}for(var ab=0,Q;ab<D;ab++){Q="";for(var Z=0;Z<R;Z++){Q+=B[Z][ab]}if(Q){C.push(Q)}}for(var ab=0,N;ab<B.length;ab++){N=[];for(var Z=0,t;Z<B[ab].length;Z++){t={id:B[ab][Z],uuid:Ext.data.IdGenerator.get("uuid").generate(),dim:ab,axis:ah};if(ab===B.length-1){t.leaf=true}N.push(t)}U.push(N)}for(var ab=0,M,P,ad;ab<U.length;ab++){P=[];for(var Z=0,t,af=0,s;Z<U[ab].length;Z++){t=U[ab][Z];P.push(t.id);if(af===0){t[v]=w[ab];if(t.leaf){t.children=0}t.oldest=true;if(ab===0){t.root=true}s=t}t.oldestSibling=s;if(++af===w[ab]){af=0}}if(ab>0){M=U[ab-1];ad=Ext.Array.unique(P);for(var Z=0;Z<M.length;Z++){M[Z].children=ad.length}}}if(R>1){for(var ab=1,E;ab<R;ab++){E=U[ab];for(var Z=0,af=0,I=w[ab-1];Z<E.length;Z++){E[Z].parent=U[ab-1][Z]}}}if(U.length){var z=R>1?p.prototype.array.sort(Ext.clone(w))[1]:D,G=U[U.length-1];for(var ab=0,ac,J,t,O=[];ab<G.length;ab++){ac=G[ab];O.push(ac.uuid);J=[];t=ac;while(t.parent){t=t.parent;J.push(t.oldestSibling.uuid)}ac.uuids=Ext.clone(J);if(O.length===z){for(var Z=(ab-z)+1,ac;Z<=ab;Z++){ac=G[Z];ac.uuids=ac.uuids.concat(O)}O=[]}}}for(var ab=0;ab<U.length;ab++){for(var Z=0,T;Z<U[ab].length;Z++){T=U[ab][Z];y[T.uuid]=T}}return{type:ah,items:H,xItems:{unique:u,gui:K,all:B},objects:{all:U},ids:C,span:w,dims:R,size:D,uuidObjectMap:y}};l.layout.isHierarchy=function(t,s,u){return t.showHierarchy&&Ext.isObject(s.metaData.ouHierarchy)&&s.metaData.ouHierarchy.hasOwnProperty(u)};l.layout.layout2plugin=function(x,u){var x=Ext.clone(x),w=Ext.Array.clean([].concat(x.columns||[],x.rows||[],x.filters||[]));x.url=q.contextPath;if(u){x.el=u}if(Ext.isString(x.id)){return{id:x.id}}for(var t=0,y,v;t<w.length;t++){y=w[t];delete y.id;delete y.ids;delete y.type;delete y.dimensionName;delete y.objectName;for(var s=0,v;s<y.items.length;s++){v=y.items[s];delete v.name;delete v.code;delete v.created;delete v.lastUpdated;delete v.value}}if(x.showRowTotals){delete x.showRowTotals}if(x.showColTotals){delete x.showColTotals}if(x.showColSubTotals){delete x.showColSubTotals}if(x.showRowSubTotals){delete x.showRowSubTotals}if(x.showDimensionLabels){delete x.showDimensionLabels}if(!x.hideEmptyRows){delete x.hideEmptyRows}if(!x.skipRounding){delete x.skipRounding}if(!x.showHierarchy){delete x.showHierarchy}if(!x.completedOnly){delete x.completedOnly}if(x.displayDensity===m.finals.style.normal){delete x.displayDensity}if(x.fontSize===m.finals.style.normal){delete x.fontSize}if(x.digitGroupSeparator===m.finals.style.space){delete x.digitGroupSeparator}if(!x.legendSet){delete x.legendSet}if(!x.sorting){delete x.sorting}if(x.aggregationType===m.finals.style.default_){delete x.aggregationType}if(x.dataApprovalLevel&&x.dataApprovalLevel.id===m.finals.style.default_){delete x.dataApprovalLevel}delete x.parentGraphMap;delete x.reportingPeriod;delete x.organisationUnit;delete x.parentOrganisationUnit;delete x.regression;delete x.cumulative;delete x.sortOrder;delete x.topLimit;return x};l.response={};l.response.getExtendedResponse=function(t,s){var u=[];s=Ext.clone(s);s.nameHeaderMap={};s.idValueMap={};(function(){for(var v=0,w;v<s.headers.length;v++){w=s.headers[v];w.index=v;if(w.meta){w.ids=Ext.clone(t.dimensionNameIdsMap[w.name])||[];w.size=w.ids.length;u=u.concat(w.ids)}}for(var v=0,w;v<s.headers.length;v++){w=s.headers[v];s.nameHeaderMap[w.name]=w}}());(function(){var B=s.nameHeaderMap[m.finals.dimension.value.value].index,w=s.nameHeaderMap[m.finals.dimension.category.dimensionName],F=n.data.dimensionName,C=n.category.dimensionName,y=t.axisDimensionNames,D=[];for(var z=0;z<y.length;z++){D.push(s.nameHeaderMap[y[z]].index);if(w&&!Ext.Array.contains(y,C)&&y[z]===F){D.push(w.index)}}for(var z=0,E,v;z<s.rows.length;z++){E=s.rows[z];v="";for(var x=0,A;x<D.length;x++){A=D[x];v+=E[A]}s.idValueMap[v]=E[B]}}());return s};l.response.addOuHierarchyDimensions=function(v){var t=v.headers,s=v.metaData.ouHierarchy,D=v.rows,x,B=0,z=[],u=[],A;if(!s){return}for(var w=0;w<t.length;w++){if(t[w].name==="ou"){x=w;break}}for(var w=0;w<D.length;w++){B=Math.max(B,Ext.Array.clean(s[D[w][x]].split("/")).length)}for(var w=0;w<B;w++){z.push("")}for(var w=0,C,y;w<D.length;w++){C=D[w];y=Ext.applyIf(Ext.Array.clean(s[C[x]].split("/")),Ext.clone(z));Ext.Array.insert(C,x,y)}for(var w=0;w<B;w++){u.push({column:"Organisation unit",hidden:false,meta:true,name:"ou",type:"java.lang.String"})}Ext.Array.insert(t,x,u);return v};l.response.getValue=function(s){var t=parseFloat(s);if(Ext.isBoolean(s)){return 1}if(!Ext.isNumber(t)||t!=s){return 0}return t}}());(function(){j.mask={};j.mask.show=function(s,t){if(!Ext.isObject(s)){console.log("support.gui.mask.show: component not an object");return null}t=t||"Loading..";if(s.mask&&s.mask.destroy){s.mask.destroy();s.mask=null}s.mask=new Ext.create("Ext.LoadMask",s,{shadow:false,msg:t,style:"box-shadow:0",bodyStyle:"box-shadow:0"});s.mask.show()};j.mask.hide=function(s){if(!Ext.isObject(s)){console.log("support.gui.mask.hide: component not an object");return null}if(s.mask&&s.mask.destroy){s.mask.destroy();s.mask=null}};j.window=j.window||{};j.window.setAnchorPosition=function(s,x){var u=i.getViewportWidth(),v=x?x.getPosition()[0]:4,t=s.getWidth(),z=x?x.getPosition()[1]+x.getHeight()+4:33;if((v+t)>u){s.setPosition((u-t-2),z)}else{s.setPosition(v,z)}};j.window.addHideOnBlurHandler=function(s){var t=Ext.get(Ext.query(".x-mask")[0]);t.on("click",function(){if(s.hideOnBlur){s.hide()}});s.hasHideOnBlurHandler=true};j.window.addDestroyOnBlurHandler=function(s){var u=Ext.query(".x-mask"),t=Ext.get(u[0]);t.on("click",function(){if(s.destroyOnBlur){s.destroy()}});s.hasDestroyOnBlurHandler=true};j.message={};j.message.alert=function(v){var s={},t,u;if(!v||(Ext.isObject(v)&&!v.message&&!v.responseText)){return}if(Ext.isObject(v)&&v.responseText&&!v.message){v=Ext.decode(v.responseText)}if(Ext.isString(v)){v={status:"ERROR",message:v}}t=(v.status||"INFO").toLowerCase();s.title=v.status;s.iconCls="ns-window-title-messagebox "+t;s.html="";s.html+=v.httpStatusCode?"Code: "+v.httpStatusCode+"<br>":"";s.html+=v.httpStatus?"Status: "+v.httpStatus+"<br><br>":"";s.html+=v.message+(v.message.substr(v.message.length-1)==="."?"":".");s.bodyStyle="padding: 12px; background: #fff; max-width: 600px; max-height: "+i.getCenterRegionHeight()/2+"px";s.modal=true;s.destroyOnBlur=true;s.listeners={show:function(x){x.setPosition(x.getPosition()[0],x.getPosition()[1]/2);if(!x.hasDestroyOnBlurHandler){j.window.addDestroyOnBlurHandler(x)}}};u=Ext.create("Ext.window.Window",s);u.show()};j.analytics={};j.analytics.getParamString=function(E,v){var z=v?E.sortedAxisDimensionNames:E.axisDimensionNames,G=v?E.sortedFilterDimensions:E.filterDimensions,s=v?E.dimensionNameSortedIdsMap:E.dimensionNameIdsMap,w="?",u=false,t=E.dimensionNameItemsMap,H=n.indicator.dimensionName,D=n.category.dimensionName,y=["COUNT","SUM","STDDEV","VARIANCE","MIN","MAX"],F=E.displayProperty||q.userAccount.settings.keyAnalysisDisplayProperty||"name";for(var A=0,x,C;A<z.length;A++){x=z[A];w+="dimension="+x;C=Ext.clone(s[x]);if(x===H){C=Ext.Array.unique(C)}if(x!==D){w+=":"+C.join(";")}if(A<(z.length-1)){w+="&"}}if(u){w+="&dimension="+m.finals.dimension.category.dimensionName}if(Ext.isArray(G)&&G.length){for(var A=0,B;A<G.length;A++){B=G[A];w+="&filter="+B.dimensionName+":"+B.ids.join(";")}}if(E.showHierarchy){w+="&hierarchyMeta=true"}if(E.completedOnly){w+="&completedOnly=true"}if(Ext.Array.contains(y,E.aggregationType)){w+="&aggregationType="+E.aggregationType}w+="&displayProperty="+F.toUpperCase();if(Ext.isArray(E.userOrgUnit)&&E.userOrgUnit.length){w+="&userOrgUnit=";for(var A=0;A<E.userOrgUnit.length;A++){w+=E.userOrgUnit[A]+(A<E.userOrgUnit.length-1?";":"")}}if(Ext.isObject(E.dataApprovalLevel)&&Ext.isString(E.dataApprovalLevel.id)&&E.dataApprovalLevel.id!==m.finals.style.default_){w+="&approvalLevel="+E.dataApprovalLevel.id}if(E.program&&E.program.id){w+="&program="+E.program.id}if(E.relativePeriodDate){w+="&relativePeriodDate="+E.relativePeriodDate}if(E.skipRounding){w+="&skipRounding=true"}return w.replace(/#/g,".")};j.analytics.validateUrl=function(t){var u;if(Ext.isIE){u="Too many items selected (url has "+t.length+" characters). Internet Explorer accepts maximum 2048 characters."}else{var s=t.length>8000?"8000":(t.length>4000?"4000":"2000");u="Too many items selected (url has "+t.length+" characters). Please reduce to less than "+s+" characters."}u+="\n\nHint: A good way to reduce the number of items is to use relative periods and level/group organisation unit selection modes.";o(u,"warning")};j.pivot={};j.pivot.sort=function(y,D,s){var D=Ext.clone(D),t=y.sorting.id,w=y.rows[0],u=D.idValueMap,z=y.sorting?y.sorting.direction:"DESC",x;w.ids=[];if(Ext.isString(t)){t=t.toLowerCase()==="total"?"total_":t}else{if(Ext.isNumber(t)){if(t===0){t="total_"}else{t=s.ids[parseInt(t)-1]}}else{return y}}for(var v=0,C,B,A;v<w.items.length;v++){C=w.items[v];B=t+C.id;A=parseFloat(u[B]);C.value=Ext.isNumber(A)?A:(Number.MAX_VALUE*-1)}p.prototype.array.sort(w.items,z,"value");for(var v=0;v<w.items.length;v++){w.ids.push(w.items[v].id)}if(t!==y.sorting.id){y.sorting.id=t}return y};j.pivot.getHtml=function(K,t,Q,J){var D,L,s,w,x,B,N,z,v,C,H,M,S,A=function(T){var U;if(!T){return null}U=T.xItems.unique;if(U){return U.length<2?1:(T.size/U[0].length)}return null},P=A(Q),I=A(J),G=[],R=[],y=[],F={},E=Ext.isObject(K.legendSet)&&Ext.isArray(K.legendSet.legends)&&K.legendSet.legends.length,u=0,O;t.sortableIdObjects=[];D=function(T,U){U=U||2;return parseFloat(p.prototype.number.roundIf(T,2)).toString()};L=function(W,ag){var ae,Z,aa,ac,U,V,ai,T=Ext.isObject(W)&&Ext.isString(W.type)&&W.type.substr(0,5)==="value"&&!W.empty,ad=T&&W.type==="value",ah="",Y="",ab;ab=function(aj){var ak=aj.htmlValue,al=parseFloat(aj.htmlValue);if(aj.collapsed){return""}if(ad){if(Ext.isBoolean(ak)){return ak}if(!Ext.isNumber(al)||al!=ak){return ak}return al}return ak||""};if(!Ext.isObject(W)){return""}if(W.hidden||W.collapsed){return""}u=u+1;if(ad&&K.legendSet){var af=parseFloat(W.value);Z=K.legendSet.legends;for(var X=0;X<Z.length;X++){if(Ext.Number.constrain(af,Z[X].startValue,Z[X].endValue)===af){ae=Z[X].color}}}aa=W.colSpan?'colspan="'+W.colSpan+'" ':"";ac=W.rowSpan?'rowspan="'+W.rowSpan+'" ':"";U=ab(W);U=W.type!=="dimension"?p.prototype.number.prettyPrint(U,K.digitGroupSeparator):U;ah+=W.hidden?" td-hidden":"";ah+=W.collapsed?" td-collapsed":"";ah+=ad?" pointer":"";ah+=W.cls?" "+W.cls:"";if(Ext.isString(ag)){ah+=" td-sortable";t.sortableIdObjects.push({id:ag,uuid:W.uuid})}Y+="<td "+(W.uuid?('id="'+W.uuid+'" '):"");Y+=' class="'+ah+'" '+aa+ac;Y+='style="'+(ae&&ad?"color:"+ae+"; ":"")+'">'+U+"</td>";return Y};x=function(){return !!K.showColTotals};w=function(){return !!K.showRowTotals};doColSubTotals=function(){return !!K.showColSubTotals&&J&&J.dims>1};doRowSubTotals=function(){return !!K.showRowSubTotals&&Q&&Q.dims>1};B=function(){return(J&&J.dims===1)};N=function(){var ac=[],T;getEmptyNameTdConfig=function(ad){ad=ad||{};return L({cls:ad.cls?" "+ad.cls:"pivot-empty",colSpan:ad.colSpan?ad.colSpan:1,rowSpan:ad.rowSpan?ad.rowSpan:1,htmlValue:ad.htmlValue?ad.htmlValue:"&nbsp;"})};T=function(af){var ad=[];if(af<Q.dims-1){if(J&&J.dims){for(var ae=0;ae<J.dims-1;ae++){ad.push(getEmptyNameTdConfig({cls:"pivot-dim-label"}))}}ad.push(getEmptyNameTdConfig({cls:"pivot-dim-label",htmlValue:n.objectNameMap[K.columnObjectNames[af]].name}))}else{if(J&&J.dims){for(var ae=0;ae<J.dims-1;ae++){ad.push(getEmptyNameTdConfig({cls:"pivot-dim-label",htmlValue:n.objectNameMap[K.rowObjectNames[ae]].name}))}}ad.push(getEmptyNameTdConfig({cls:"pivot-dim-label",htmlValue:(J?n.objectNameMap[K.rowObjectNames[ae]].name:"")+(Q&&J?"&nbsp;/&nbsp;":"")+(Q?n.objectNameMap[K.columnObjectNames[af]].name:"")}))}return ad};if(!Q){if(J&&K.showDimensionLabels){var ab=[];for(var Y=0;Y<K.rowObjectNames.length;Y++){ab.push(getEmptyNameTdConfig({cls:"pivot-dim-label",htmlValue:n.objectNameMap[K.rowObjectNames[Y]].name}))}ac.push(ab)}return ac}for(var Y=0,aa;Y<Q.dims;Y++){aa=[];if(K.showDimensionLabels){aa=aa.concat(T(Y))}else{if(Y===0){aa.push(Q&&J?getEmptyNameTdConfig({colSpan:J.dims,rowSpan:Q.dims}):"")}}for(var W=0,X,U=0,Z,V;W<Q.size;W++){U++;Z=null;V=null;X=Q.objects.all[Y][W];X.type="dimension";X.cls="pivot-dim";X.noBreak=false;X.hidden=!(X.rowSpan||X.colSpan);X.htmlValue=l.layout.getItemName(K,t,X.id,true);if(Y===Q.dims-1&&B()){Z=Q.ids[W]}aa.push(L(X,Z));if(Y===0&&U===Q.span[Y]&&doRowSubTotals()){aa.push(L({type:"dimensionSubtotal",cls:"pivot-dim-subtotal cursor-default",rowSpan:Q.dims,htmlValue:"&nbsp;"}));U=0}if(Y===0&&(W===Q.size-1)&&w()){V=B()?"total_":null;aa.push(L({uuid:Ext.data.IdGenerator.get("uuid").generate(),type:"dimensionTotal",cls:"pivot-dim-total",rowSpan:Q.dims,htmlValue:"Total"},V))}}ac.push(aa)}return ac};z=function(){var aJ=[],af=[],av,Z=[],an=[],aj,al=Q?Q.size:1,ax=J?J.size:1,am;am=function(aK){if(!aK.children){aK.collapsed=true;if(aK.parent){aK.parent.oldestSibling.children--}}if(aK.parent){am(aK.parent.oldestSibling)}};if(J){for(var aF=0,ah;aF<J.size;aF++){ah=[];for(var aE=0,X,az;aE<J.dims;aE++){X=J.objects.all[aE][aF];X.type="dimension";X.cls="pivot-dim td-nobreak"+(l.layout.isHierarchy(K,t,X.id)?" align-left":"");X.noBreak=true;X.hidden=!(X.rowSpan||X.colSpan);X.htmlValue=l.layout.getItemName(K,t,X.id,true);ah.push(X)}af.push(ah)}}else{if(K.showDimensionLabels){af.push([{type:"transparent",cls:"pivot-transparent-row"}])}}for(var aF=0,V,Y,aC=t.idValueMap;aF<ax;aF++){V=[];Y=[];for(var aE=0,au,aA,ar,aH,T,aa,U;aE<al;aE++){T=false;U=[];au=((Q?Q.ids[aE]:"")+(J?J.ids[aF]:""));aa=Ext.data.IdGenerator.get("uuid").generate();if(Q){U=U.concat(Q.objects.all[Q.dims-1][aE].uuids)}if(J){U=U.concat(J.objects.all[J.dims-1][aF].uuids)}ar=aC[au];if(Ext.isDefined(ar)){aA=l.response.getValue(ar);aH=ar}else{aA=0;aH="&nbsp;";T=true}V.push(aA);Y.push({uuid:aa,type:"value",cls:"pivot-value"+(T?" cursor-default":""),value:aA,htmlValue:aH,empty:T,uuids:U});F[aa]=U}G.push(V);R.push(Y)}if(Q&&w()){for(var aF=0,T=[],aq=0;aF<R.length;aF++){for(aE=0,X;aE<R[aF].length;aE++){X=R[aF][aE];T.push(X.empty);aq+=X.value}Z.push({type:"valueTotal",cls:"pivot-value-total",value:aq,htmlValue:Ext.Array.contains(T,false)?D(aq):"",empty:!Ext.Array.contains(T,false)});if(B()){var ae="total_"+J.ids[aF],ai=!Ext.Array.contains(T,false);t.idValueMap[ae]=ai?null:aq}T=[];aq=0}}if(Q&&J){if(K.hideEmptyRows){for(var aF=0,aw,W,ak;aF<R.length;aF++){aw=R[aF];W=!Ext.Array.contains(Ext.Array.pluck(aw,"empty"),false);if(W){for(var aE=0;aE<aw.length;aE++){aw[aE].collapsed=true}if(w()){Z[aF].collapsed=true}ak=af[aF][J.dims-1];am(ak)}}}}av=R;if(doRowSubTotals()){var ao=[];for(var aF=0,ah,ad,ag;aF<av.length;aF++){ah=[];ad=0;ag=0;for(var aE=0,ap,aI=[],T=[];aE<av[aF].length;aE++){ap=av[aF][aE];ad+=ap.value;T.push(!!ap.empty);aI.push(!!ap.collapsed);ag++;ah.push(ap);if(ag===P){var ai=!Ext.Array.contains(T,false);ah.push({type:"valueSubtotal",cls:"pivot-value-subtotal"+(ai?" cursor-default":""),value:ad,htmlValue:ai?"&nbsp;":D(ad),empty:ai,collapsed:!Ext.Array.contains(aI,false)});ag=0;ad=0;T=[];aI=[]}}ao.push(ah)}av=ao}if(doColSubTotals()){var at=[],ao=[],aG=[],aD;aD=function(aN){var aM=[];for(var aK=0,aL;aK<J.dims;aK++){aL={};aL.type="dimensionSubtotal";aL.cls="pivot-dim-subtotal cursor-default";aL.collapsed=Ext.Array.contains(aN,true);if(aK===0){aL.htmlValue="&nbsp;";aL.colSpan=J.dims}else{aL.hidden=true}aM.push(aL)}return aM};for(var aF=0,ah,aI=[];aF<af.length;aF++){at.push(af[aF]);aI.push(!!af[aF][0].collapsed);if(!Ext.isArray(af[aF+1])||!!af[aF+1][0].root){at.push(aD(aI));aI=[]}}for(var aF=0;aF<at.length;aF++){ao.push([])}for(var aF=0;aF<av[0].length;aF++){for(var aE=0,ab=0,ay=0,ac=0,T=[],aI,ap;aE<av.length;aE++){ap=av[aE][aF];ao[ay++].push(ap);ac+=ap.value;T.push(!!ap.empty);ab++;if(af[aE][0].root){aI=!!af[aE][0].collapsed}if(!Ext.isArray(af[aE+1])||af[aE+1][0].root){var ai=!Ext.Array.contains(T,false);ao[ay++].push({type:ap.type==="value"?"valueSubtotal":"valueSubtotalTotal",value:ac,htmlValue:ai?"&nbsp;":D(ac),collapsed:aI,cls:(ap.type==="value"?"pivot-value-subtotal":"pivot-value-subtotal-total")+(ai?" cursor-default":"")});ab=0;ac=0;T=[]}}}for(var aF=0,X,aI=[],T=[],ac=0,aB=0;aF<Z.length;aF++){X=Z[aF];aG.push(X);aI.push(!!X.collapsed);T.push(!!X.empty);ac+=X.value;aB++;if(aB===J.span[0]){var ai=!Ext.Array.contains(T,false);aG.push({type:"valueTotalSubgrandtotal",cls:"pivot-value-total-subgrandtotal"+(ai?" cursor-default":""),value:ac,htmlValue:ai?"&nbsp;":D(ac),empty:ai,collapsed:!Ext.Array.contains(aI,false)});aI=[];T=[];ac=0;aB=0}}af=at;av=ao;Z=aG}for(var aF=0,ah;aF<av.length;aF++){ah=[];ah=ah.concat(af[aF]);ah=ah.concat(av[aF]);if(Q){ah=ah.concat(Z[aF])}an.push(ah)}for(var aF=0,ah;aF<an.length;aF++){ah=[];for(var aE=0;aE<an[aF].length;aE++){ah.push(L(an[aF][aE]))}aJ.push(ah)}return aJ};C=function(){var aa=[];if(J&&x()){var ad;for(var V=0,Z=0,Y=[];V<R[0].length;V++){for(var T=0,U;T<R.length;T++){U=R[T][V];Z+=U.value;Y.push(!!U.empty)}y.push({type:"valueTotal",value:Z,htmlValue:Ext.Array.contains(Y,false)?D(Z):"",empty:!Ext.Array.contains(Y,false),cls:"pivot-value-total"});Z=0;Y=[]}ad=y;if(Q&&doRowSubTotals()){var W=[];for(var V=0,ac,X=0,Y=[],ab=0;V<ad.length;V++){ac=ad[V];W.push(ac);X+=ac.value;Y.push(!!ac.empty);ab++;if(ab===P){W.push({type:"valueTotalSubgrandtotal",value:X,htmlValue:Ext.Array.contains(Y,false)?D(X):"",empty:!Ext.Array.contains(Y,false),cls:"pivot-value-total-subgrandtotal"});X=0;ab=0}}ad=W}for(var V=0;V<ad.length;V++){aa.push(L(ad[V]))}}return aa};H=function(){var V=0,W=[],T=[];if(w()&&x()){for(var U=0,X;U<y.length;U++){X=y[U];V+=X.value;W.push(X.empty)}if(Q&&J){T.push(L({type:"valueGrandTotal",cls:"pivot-value-grandtotal",value:V,htmlValue:Ext.Array.contains(W,false)?D(V):"",empty:!Ext.Array.contains(W,false)}))}}return T};M=function(){var V,U=C(),W=H(),X,T=[];if(x()){if(J){V=[L({type:"dimensionSubtotal",cls:"pivot-dim-total",colSpan:J.dims,htmlValue:"Total"})]}X=[].concat(V||[],U||[],W||[]);T.push(X)}return T};S=function(){var T="pivot",V;T+=K.displayDensity&&K.displayDensity!==m.finals.style.normal?" displaydensity-"+K.displayDensity:"";T+=K.fontSize&&K.fontSize!==m.finals.style.normal?" fontsize-"+K.fontSize:"";V='<table id="'+K.tableUuid+'" class="'+T+'">';for(var U=0;U<O.length;U++){V+="<tr>"+O[U].join("")+"</tr>"}return V+="</table>"};return function(){O=Ext.Array.clean([].concat(N()||[],z()||[],M()||[]));return{html:S(O),uuidDimUuidsMap:F,xColAxis:Q,xRowAxis:J,tdCount:u}}()}}());(function(){if(Ext.isArray(q.dimensions)){p.prototype.array.sort(q.dimensions);for(var s=0,t;s<q.dimensions.length;s++){t=q.dimensions[s];t.dimensionName=t.id;t.objectName=m.finals.dimension.dimension.objectName;m.finals.dimension.objectNameMap[t.id]=t}}if(q.user&&q.user.ouc){p.prototype.array.sort(q.user.ouc)}q.idLegendSetMap={};for(var s=0,u;s<q.legendSets.length;s++){u=q.legendSets[s];q.idLegendSetMap[u.id]=u}}());o=j.message.alert;return{init:q,conf:m,api:k,support:p,service:l,web:j,app:i,webAlert:o}};g.plugin={};var f={user:{}},e=[],h=false,b=false,a,c,d;a=function(k){var q=false,p=[],j=0,n="json",o,m;f.contextPath=k.url;m=function(){if(++j===p.length){b=true;for(var r=0;r<e.length;r++){d(e[r])}e=[]}};o=function(i,r){if(r.crossDomain&&Ext.isString(r.username)&&Ext.isString(r.password)){i.headers=Ext.isObject(r.headers)?r.headers:{};i.headers.Authorization="Basic "+btoa(r.username+":"+r.password)}Ext.Ajax.request(i)};p.push({url:f.contextPath+"/api/me/user-account."+n,disableCaching:false,success:function(w){f.userAccount=w.responseText?Ext.decode(w.responseText):w;var v="en",t="name",s,u,i;f.userAccount.settings.keyUiLocale=f.userAccount.settings.keyUiLocale||v;f.userAccount.settings.keyAnalysisDisplayProperty=f.userAccount.settings.keyAnalysisDisplayProperty||t;u=f.contextPath;i=f.userAccount.settings.keyUiLocale;keyAnalysisDisplayProperty=f.userAccount.settings.keyAnalysisDisplayProperty;s=keyAnalysisDisplayProperty===t?keyAnalysisDisplayProperty:keyAnalysisDisplayProperty+"|rename("+t+")";f.namePropertyUrl=s;m()}});p.push({url:f.contextPath+"/api/organisationUnits."+n+"?userOnly=true&fields=id,name,children[id,name]&paging=false",disableCaching:false,success:function(v){var u=(v.responseText?Ext.decode(v.responseText).organisationUnits:v)||[],t=[],w=[];if(u.length){for(var s=0,x;s<u.length;s++){x=u[s];t.push(x.id);if(x.children){w=Ext.Array.clean(w.concat(Ext.Array.pluck(x.children,"id")||[]))}}f.user=f.user||{};f.user.ou=t;f.user.ouc=w}else{alert("User is not assigned to any organisation units")}m()}});p.push({url:f.contextPath+"/api/dimensions."+n+"?fields=id,name&paging=false",disableCaching:false,success:function(i){f.dimensions=i.responseText?Ext.decode(i.responseText).dimensions:i.dimensions;m()}});p.push({url:f.contextPath+"/api/legendSets.json?fields=id,name,legends[id,name,startValue,endValue,color]&paging=false",success:function(i){f.legendSets=Ext.decode(i.responseText).legendSets||[];m()}});for(var l=0;l<p.length;l++){o(p[l],k)}};c=function(j){var k="",l=j.dashboard?f.contextPath+"/dhis-web-commons/javascripts/plugin/images/arrowupdown.png":"//dhis2-cdn.org/v220/plugin/images/arrowupdown.png",i=j.dashboard?f.contextPath+"/dhis-web-commons/javascripts/plugin/images/error_m.png":"//dhis2-cdn.org/v220/plugin/images/error_m.png";k+="table.pivot { font-family: arial,sans-serif,ubuntu,consolas; border-collapse: collapse; border-spacing: 0px; border: 0 none; } \n";k+=".td-nobreak { white-space: nowrap; } \n";k+=".td-hidden { display: none; } \n";k+=".td-collapsed { display: none; } \n";k+="table.pivot.displaydensity-COMFORTABLE td { padding: 7px } \n";k+="table.pivot.displaydensity-COMPACT td { padding: 3px } \n";k+="table.pivot.fontsize-LARGE td { font-size: 13px } \n";k+="table.pivot.fontsize-SMALL td { font-size: 10px } \n";k+=".pivot td { font-family: arial, sans-serif, helvetica neue, helvetica !important; padding: 5px; border: 1px solid #b2b2b2; font-size: 11px } \n";k+=".pivot-dim { background-color: #dae6f8; text-align: center; } \n";k+=".pivot-dim.highlighted { background-color: #c5d8f6; } \n";k+=".pivot-dim-subtotal { background-color: #cad6e8; text-align: center; } \n";k+=".pivot-dim-total { background-color: #bac6d8; text-align: center; } \n";k+=".pivot-dim-total.highlighted { background-color: #adb8c9; } \n";k+=".pivot-dim-empty { background-color: #dae6f8; text-align: center; } \n";k+=".pivot-value { background-color: #fff; white-space: nowrap; text-align: right; } \n";k+=".pivot-value-subtotal { background-color: #f4f4f4; white-space: nowrap; text-align: right; } \n";k+=".pivot-value-subtotal-total { background-color: #e7e7e7; white-space: nowrap; text-align: right; } \n";k+=".pivot-value-total { background-color: #e4e4e4; white-space: nowrap; text-align: right; } \n";k+=".pivot-value-total-subgrandtotal { background-color: #d8d8d8; white-space: nowrap; text-align: right; } \n";k+=".pivot-value-grandtotal { background-color: #c8c8c8; white-space: nowrap; text-align: right; } \n";k+=".pivot-dim-label { background-color: #cddaed; white-space: nowrap; text-align: center; } \n";k+=".pivot-empty { background-color: #cddaed; } \n";k+=".pivot-transparent-column { background-color: #fff; border-top-color: #fff !important; border-right-color: #fff !important; } \n";k+=".pivot-transparent-row { background-color: #fff; border-bottom-color: #fff !important; border-left-color: #fff !important; } \n";k+=".x-mask-msg { padding: 0; border: 0 none; background-image: none; background-color: transparent; } \n";k+=".x-mask-msg div { background-position: 11px center; } \n";k+=".x-mask-msg .x-mask-loading { border: 0 none; background-color: #000; color: #fff; border-radius: 2px; padding: 12px 14px 12px 30px; opacity: 0.65; } \n";k+=".x-mask { opacity: 0 } \n";k+=".pivot td.legend { padding: 0; } \n";k+=".pivot div.legendCt { display: table; float: right; width: 100%; } \n";k+=".pivot div.arrowCt { display: table-cell; vertical-align: top; width: 8px; } \n";k+=".pivot div.arrow { width: 0; height: 0; } \n";k+=".pivot div.number { display: table-cell; } \n",k+=".pivot div.legendColor { display: table-cell; width: 2px; } \n";k+=".pointer { cursor: pointer; } \n";k+='.td-sortable { background-image: url("'+l+'"); background-repeat: no-repeat; background-position: right center; padding-right: 15px !important; } \n';k+=".ns-plugin-alert { width: 90%; padding: 5%; color: #777 } \n";k+=".x-window-body { font-size: 13px; } \n";k+=".ns-window-title-messagebox { padding-left: 16px; background-position-y: 1px; } \n";k+='.ns-window-title-messagebox.error { background-image: url("'+i+'"); } \n';Ext.util.CSS.createStyleSheet(k)};d=function(l){var n,k,j,i,m={core:{},app:{}};n=function(o){if(!Ext.isObject(o)){console.log("Report table configuration is not an object");return}if(!Ext.isString(o.el)){console.log("No valid element id provided");return}o.id=o.id||o.uid;return true};k=function(w,z){var y=w.core.init,r=w.core.api,t=w.core.conf,x=w.core.support,s=w.core.service,q=w.core.web,v="json",u={json:"application/json"},p={"Content-Type":u[v],Accepts:u[v]},o=Ext.get(y.el);y.el=l.el;w.plugin=z.plugin;w.dashboard=z.dashboard;w.crossDomain=z.crossDomain;w.skipMask=z.skipMask;w.skipFade=z.skipFade;w.el=z.el;w.username=z.username;w.password=z.password;w.ajax=x.connection.ajax;q.message=q.message||{};q.message.alert=function(A){var B=Ext.get(y.el);if(B){B.setStyle("opacity",1);B.update('<div class="ns-plugin-alert">'+A+"</div>")}};q.events=q.events||{};q.events.setColumnHeaderMouseHandlers=function(E,B,A,G){if(Ext.isArray(G.sortableIdObjects)){for(var C=0,F,D;C<G.sortableIdObjects.length;C++){F=G.sortableIdObjects[C];D=Ext.get(F.uuid);if(D&&D.dom){D.dom.layout=E;D.dom.xLayout=B;D.dom.response=A;D.dom.xResponse=G;D.dom.metaDataId=F.id;D.dom.onColumnHeaderMouseClick=q.events.onColumnHeaderMouseClick;D.dom.onColumnHeaderMouseOver=q.events.onColumnHeaderMouseOver;D.dom.onColumnHeaderMouseOut=q.events.onColumnHeaderMouseOut;D.dom.setAttribute("onclick","this.onColumnHeaderMouseClick(this.layout, this.xLayout, this.response, this.xResponse, this.metaDataId)");D.dom.setAttribute("onmouseover","this.onColumnHeaderMouseOver(this)");D.dom.setAttribute("onmouseout","this.onColumnHeaderMouseOut(this)")}}}};q.events.onColumnHeaderMouseClick=function(C,B,A,D,E){if(C.sorting&&C.sorting.id===E){C.sorting.direction=x.prototype.str.toggleDirection(C.sorting.direction)}else{C.sorting={id:E,direction:"DESC"}}q.mask.show(w.app.centerRegion,"Sorting...");Ext.defer(function(){q.pivot.createTable(C,A,null,false)},10)};q.events.onColumnHeaderMouseOver=function(A){var B=Ext.get(A);if(B){B.addCls("pointer highlighted")}};q.events.onColumnHeaderMouseOut=function(A){var B=Ext.get(A);if(B){B.removeCls("pointer highlighted")}};q.pivot=q.pivot||{};q.pivot.loadTable=function(C){var D,B,A={};if(!(C&&C.id)){console.log("Error, no report table id");return}D=function(F){var E=r.layout.Layout((F.responseText?Ext.decode(F.responseText):F),C);if(E){q.pivot.getData(E,true)}};B=function(E){console.log(C.id,(E.responseText?Ext.decode(E.responseText):E))};A.url=y.contextPath+"/api/reportTables/"+C.id+"."+v+"?fields="+w.core.conf.url.analysisFields.join(",");A.disableCaching=false;A.headers=p;A.success=D;A.failure=B;w.ajax(A,w)};q.pivot.getData=function(D,E){var B,F,A,C;if(!D){return}C=function(G){if(!z.skipMask){q.mask.hide(w.app.centerRegion)}};B=s.layout.getExtendedLayout(D);F=q.analytics.getParamString(B)+"&skipData=true";A=q.analytics.getParamString(B,true)+"&skipMeta=true";if(!z.skipMask){q.mask.show(w.app.centerRegion)}w.ajax({url:y.contextPath+"/api/analytics.json"+F,timeout:60000,headers:{"Content-Type":"application/json",Accepts:"application/json"},disableCaching:false,failure:function(G){C(G)},success:function(H){var G=Ext.decode(H.responseText).metaData;w.ajax({url:y.contextPath+"/api/analytics.json"+A,timeout:60000,headers:{"Content-Type":"application/json",Accepts:"application/json"},disableCaching:false,failure:function(I){C(I)},success:function(J){w.app.dateCreate=new Date();var I=r.response.Response(Ext.decode(J.responseText));if(!I){C();return}I.metaData=G;w.app.paramString=A;q.pivot.createTable(D,I,null,E)}},w)}},w)};q.pivot.createTable=function(H,F,N,C){var L,A,E,M,G,J=s.layout.getExtendedLayout,D=s.layout.getSyncronizedXLayout,I=s.response.getExtendedResponse,K=s.layout.getExtendedAxis,B=function(O){return z.dashboard&&O?'<div style="height: 19px; line-height: 14px; width: 100%; font: bold 12px LiberationSans; color: #333; text-align: center; letter-spacing: -0.1px"">'+O+"</div>":""};G=function(O,P){A=K(O,"col");E=K(O,"row");return q.pivot.getHtml(O,P,A,E)};L=D(J(H),N||F);w.app.dateSorting=new Date();if(H.sorting){if(!N){N=I(L,F);G(L,N)}q.pivot.sort(L,N,A||w.app.xColAxis);L=J(r.layout.Layout(L))}else{N=s.response.getExtendedResponse(L,F)}M=G(L,N);w.app.dateRender=new Date();w.app.centerRegion.update(B(H.name)+M.html);w.app.layout=H;w.app.xLayout=L;w.app.response=F;w.app.xResponse=N;w.app.uuidDimUuidsMap=l.uuidDimUuidsMap;w.app.uuidObjectMap=Ext.applyIf((A?A.uuidObjectMap:{}),(E?E.uuidObjectMap:{}));q.events.setColumnHeaderMouseHandlers(H,L,F,N);q.mask.hide(w.app.centerRegion);if(g.isDebug){console.log("layout",H);console.log("response",F);console.log("xResponse",N);console.log("xLayout",L);console.log("core",w.core);console.log("app",w.app)}}};j=function(){return{centerRegion:Ext.get(l.el)}};i=function(){var p=Ext.get(l.el),o;if(!n(l)){return}o={plugin:true,dashboard:Ext.isBoolean(l.dashboard)?l.dashboard:false,crossDomain:Ext.isBoolean(l.crossDomain)?l.crossDomain:true,skipMask:Ext.isBoolean(l.skipMask)?l.skipMask:false,skipFade:Ext.isBoolean(l.skipFade)?l.skipFade:false,el:Ext.isString(l.el)?l.el:null,username:Ext.isString(l.username)?l.username:null,password:Ext.isString(l.password)?l.password:null};c(l);m.core=g.getCore(f,o);k(m,o);m.app.viewport=j();m.app.centerRegion=m.app.viewport.centerRegion;g.instances.push(m);if(p){p.setViewportWidth=function(q){m.app.centerRegion.setWidth(q)}}if(l&&l.id){m.core.web.pivot.loadTable(l)}else{layout=m.core.api.layout.Layout(l);if(!layout){return}m.core.web.pivot.getData(layout)}}()};g.plugin.getTable=function(i){if(Ext.isString(i.url)&&i.url.split("").pop()==="/"){i.url=i.url.substr(0,i.url.length-1)}if(b){d(i)}else{e.push(i);if(!h){h=true;a(i)}}};DHIS=Ext.isObject(window.DHIS)?DHIS:{};DHIS.getTable=g.plugin.getTable});